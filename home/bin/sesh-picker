#!/usr/bin/env bash
# sesh session picker

set -euo pipefail

# defaults
if [[ $# -eq 0 ]]; then
    set -- --config --zoxide
fi

picker() {
    sesh connect "$(
        sesh list --icons "$@" \
            | gum filter --limit 1 --header "sesh session picker" --placeholder "session" --prompt 'ï€‚ '
    )"
}

# if we're run from inside of tmux, run in oneshot mode (either switching
# manually or inside a display-popup).
if [[ -n ${TMUX:-} ]]; then
    picker "$@"
    exit $?
fi

# outside of tmux, we want to let people select a new sesh after the current one ends.
while :; do
    picker
done
